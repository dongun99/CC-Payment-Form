<!DOCTYPE html>
<html>

<head>
    <title>Flip card demo</title>
    <meta name="viewport" content="initial-scale=1">
    <link href="https://fonts.googleapis.com/css?family=Droid+Sans+Mono" rel="stylesheet">
    <link href="css/paymentfont.min.css" rel="stylesheet">
</head>

<body>
    <style>
        body {
            font: .85em/1.2em Arial;
        }
        
        *,
        *:before,
        *:after {
            box-sizing: border-box;
        }
        
        .demo-container {
            max-width: 300px;
            margin: 50px auto;
        }
        
        #payment-form-container {
            display: flex;
            display: -webkit-box;
            display: -ms-flexbox;
            display: -webkit-flex;
            -ms-flex-flow: row wrap;
            flex-flow: row wrap;
        }
        
        input {
            -webkit-appearance: none;
            -moz-appearance: none;
            border: 1px solid #ccc;
            border-right: 1px solid #eee;
            border-bottom: 1px solid #eee;
            display: block;
            height: 37px;
            height: 2.3125rem;
            margin: 0;
            padding: 8px;
            padding: 0.5rem;
            width: 100%;
        }
        
        input:FOCUS {
            border: 1px solid lightblue;
        }
        
        input.half-line {
            width: 50%;
        }
        
        input.half-line+input.half-line {
            border-left: none;
        }
        
        #card-container {
            margin: 16px auto;
            margin: 1rem auto;
            -webkit-perspective: 1000px;
            perspective: 1000px;
        }
        
        #card-container.flip #card-flipper {
            -webkit-transform: rotateY(180deg);
            transform: rotateY(180deg);
        }
        
        #card-container,
        #card-front,
        #card-back {
            width: 300px;
            height: 175px;
            font-family: 'Droid Sans Mono', monospace;
        }
        
        #card-flipper {
            width: 300px;
            height: 175px;
            position: relative;
            border-radius: 8px;
            box-shadow: 0px 0px 12px 5px rgba(0, 0, 0, 0.05);
            -webkit-transition: 0.6s;
            transition: 0.6s;
            -webkit-transform-style: preserve-3d;
            transform-style: preserve-3d;
        }
        
        #card-front,
        #card-back {
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 8px;
            position: absolute;
            top: 0;
            left: 0;
            background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAxIDEiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiPjxsaW5lYXJHcmFkaWVudCBpZD0idnNnZyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSIwJSIgeTE9IjEwMCUiIHgyPSIxMDAlIiB5Mj0iMCUiPjxzdG9wIHN0b3AtY29sb3I9IiMwMDRkOTEiIHN0b3Atb3BhY2l0eT0iMSIgb2Zmc2V0PSIwIi8+PHN0b3Agc3RvcC1jb2xvcj0iIzAwNjhiNSIgc3RvcC1vcGFjaXR5PSIxIiBvZmZzZXQ9IjAuNDQ3Ii8+PHN0b3Agc3RvcC1jb2xvcj0iIzA2NGQ5MSIgc3RvcC1vcGFjaXR5PSIxIiBvZmZzZXQ9IjEiLz48L2xpbmVhckdyYWRpZW50PjxyZWN0IHg9IjAiIHk9IjAiIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIGZpbGw9InVybCgjdnNnZykiIC8+PC9zdmc+);
            background-image: -webkit-gradient(linear, 0% 100%, 100% 0%, color-stop(0, rgb(0, 77, 145)), color-stop(0.447, rgb(0, 104, 181)), color-stop(1, rgb(6, 77, 145)));
            /* Android 2.3 */
            background-image: -webkit-repeating-linear-gradient(bottom left, rgb(0, 77, 145) 0%, rgb(0, 104, 181) 44.7%, rgb(6, 77, 145) 100%);
            /* IE10+ */
            background-image: repeating-linear-gradient(to top right, rgb(0, 77, 145) 0%, rgb(0, 104, 181) 44.7%, rgb(6, 77, 145) 100%);
            background-image: -ms-repeating-linear-gradient(bottom left, rgb(0, 77, 145) 0%, rgb(0, 104, 181) 44.7%, rgb(6, 77, 145) 100%);
        }
        
        #card-front {
            z-index: 2;
            /* for firefox 31 */
            -webkit-transform: rotateY(0deg);
            transform: rotateY(0deg);
            color: #fff;
            background-color: #025ba3;
            /* IE9, iOS 3.2+ */
        }
        
        #card-back {
            -webkit-transform: rotateY(180deg);
            transform: rotateY(180deg);
        }
        
        #card-front #card-icon {
            position: absolute;
            top: 12px;
            right: 10px;
        }
        
        #card-front #card-icon i {
            font-size: 2rem;
        }
        
        #card-front #ph-cardnumber {
            position: absolute;
            top: 98px;
            left: 16px;
            opacity: .8em;
            font-size: 1.2em;
            text-shadow: 0px 1px 0px #000;
        }
        
        #card-front #ph-cardholder {
            position: absolute;
            top: 126px;
            left: 16px;
            text-transform: uppercase;
            font-weight: bold;
            opacity: 1em;
            font-size: .9em;
            text-shadow: 0px 1px 0px #000;
            max-width: 170px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        #card-front #ph-expiry {
            position: absolute;
            top: 126px;
            left: 228px;
            text-transform: uppercase;
            font-weight: bold;
            font-size: .9em;
            text-shadow: 0px 1px 0px #000;
        }
        
        #card-front #card-chip {
            position: absolute;
            top: 55px;
            left: 16px;
            height: 34px;
            width: 44px;
            border-radius: 8px;
            background: #ffffff;
            opacity: .7;
        }
        
        #card-front #card-chip>span {
            display: block;
            height: 14px;
            margin-top: 10px;
            border: 1px solid rgb(0, 77, 145);
            border-right: none;
            border-left: none;
        }
        
        #card-front #card-chip>span>span {
            display: block;
            height: 24px;
            margin: -6px auto 0;
            border: 1px solid rgb(0, 77, 145);
            background: #fff;
            width: 70%;
            border-radius: 8px;
        }
        
        #card-front #ph-valid-thru {
            display: block;
            position: absolute;
            top: 126px;
            left: 196px;
            width: 10px;
            font: .5em/1em Arial;
            text-transform: uppercase;
            opacity: 0.6;
        }
        
        #card-back #ph-cvc {
            position: absolute;
            top: 80px;
            left: 210px;
            height: 34px;
            width: 46px;
            border: 2px solid red;
            line-height: 2rem;
            padding-left: 4px;
            background: #fff;
            text-transform: uppercase;
            font-weight: bold;
            opacity: .8em;
        }
        
        #card-back #ph-sig-strip {
            position: absolute;
            top: 80px;
            left: 10px;
            width: 200px;
            height: 34px;
            background: #eee;
        }
        
        #card-back #ph-use-msg {
            font: .5em/1em Arial;
            color: #fff;
            position: absolute;
            top: 60px;
            left: 10px;
            opacity: .7;
            text-transform: uppercase;
        }
        
        #card-back #ph-mag-strip {
            position: absolute;
            top: 16px;
            left: 0;
            right: 0;
            height: 36px;
            background: #000;
            opacity: 0.7;
        }
        
        .invalid {
            color: yellow;
        }
        
        .noborder {
            border: none !important;
        }
    </style>
    <div class="demo-container">

        <div id="card-container">
            <div id="card-flipper">
                <div id="card-front">
                    <span id="card-chip"><span><span></span></span>
                    </span>
                    <span id="card-icon"><i id="card-icon-type" class="pf"></i></span>
                    <span id="ph-cardnumber"></span>
                    <span id="ph-cardholder"></span>
                    <span id="ph-valid-thru">Valid Thru</span>
                    <span id="ph-expiry"></span>
                </div>
                <div id="card-back">
                    <span id="ph-mag-strip"></span>
                    <span id="ph-use-msg">Use is subject to the cardholder agreement</span>
                    <span id="ph-sig-strip"></span>
                    <span id="ph-cvc"></span>
                </div>
            </div>
        </div>

        <div id="payment-form-container">
            <input id="cardnumber" placeholder="Card number" type="tel" maxlength="19" name="number">
            <input id="cardholder" placeholder="Full name" type="text" name="name">
            <input id="expiry" placeholder="MM/YY" class="half-line" maxlength="5" type="tel" name="expiry">
            <input id="cvc" placeholder="CVC" class="half-line" maxlength="4" name="cvc">
        </div>
    </div>

    <script type="text/javascript">
        var foundCardType,
            _defaultCardSpacePattern = /(?:^|\s)(\d{4})$/,
            _digitPattern = /^\d+$/,
            _cardTypeFilters = [{
                //Starts with 5[1-5] or 222100-272099
                name: 'MasterCard',
                css: 'pf-mastercard',
                pattern: /^(5)[1-5]|^(2((2[2-6][1-9])|2[3-9]|[3-6]|(7[0-1])|720))/,
                numLength: 16
            }, {
                name: 'Visa',
                css: 'pf-visa',
                pattern: /^4/,
                numLength: 16
            }, {
                name: 'AmericanExpress',
                css: 'pf-american-express',
                pattern: /^3[47]/,
                spacePattern: /^(\d{4}|\d{4}\s\d{6})$/,
                numLength: 16
            }, {
                name: 'Discover',
                css: 'pf-discover',
                pattern: /^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/,
                numLength: 16
            }, {
                name: 'maestro',
                css: 'pf-maestro',
                pattern: /^(5018|5020|5038|5612|5893|6304|6759|6761|6762|6763|0604|6390)/,
                showIssueNum: true,
                numLength: 16
            }, {
                name: 'solo',
                css: '',
                pattern: /^(6334|6767)/,
                showIssueNum: true,
                numLength: 16
            }, {
                // Switch must come after Visa to make sure that the cards are correctly typed
                name: 'switch',
                css: '',
                pattern: /^(490[35]|4911|4936|5641\s*82|6331\s*10|6333)/,
                showIssueNum: true,
                numLength: 16
            }];

        // doc ready    
        document.addEventListener('DOMContentLoaded', function() {

            var cardNumberInput = document.getElementById('cardnumber'),
                cardNumberPh = document.getElementById('ph-cardnumber'),
                cardHolderInput = document.getElementById('cardholder'),
                cardHolderPh = document.getElementById('ph-cardholder'),
                cvcInput = document.getElementById('cvc'),
                cvcPh = document.getElementById('ph-cvc'),
                expiryInput = document.getElementById('expiry'),
                expiryPh = document.getElementById('ph-expiry'),
                cardContainer = document.getElementById('card-container'),
                cardIconTypePh = document.getElementById('card-icon-type');

            cardNumberInput.addEventListener('keypress', filterNumberInput);
            cardNumberInput.addEventListener('keyup', formatCardNumber);
            cardNumberInput.addEventListener('blur', validateCardNumber);

            cardHolderInput.addEventListener('keyup', function(e) {
                cardHolderPh.innerHTML = e.target.value;
            });

            expiryInput.addEventListener('keypress', filterNumberInput);
            expiryInput.addEventListener('keyup', reformatDate);
            expiryInput.addEventListener('blur', validateExpiry);
            expiryInput.addEventListener('keyup', function() {
                expiryPh.innerHTML = this.value;
            });

            cvcInput.addEventListener('keyup', function() {
                cvcPh.innerHTML = this.value;
                (this.value !== '') ?
                cvcPh.setAttribute('class', 'noborder'):
                    cvcPh.removeAttribute('class');
            });

            cvcInput.addEventListener('keypress', filterNumberInput);
            cvcInput.addEventListener('focus', function() {
                cardContainer.classList.toggle('flip');
            });
            cvcInput.addEventListener('blur', function() {
                cardContainer.classList.toggle('flip');
            });

            function getCardType(cardNum) {
                var i,
                    n = _cardTypeFilters.length;

                if (cardNum) {
                    for (i = 0; i < n; i++) {
                        if (_cardTypeFilters[i].pattern.test(cardNum)) {
                            return _cardTypeFilters[i];
                        }
                    }
                }
            }

            function formatCardNumber(e) {
                var keyVal = getCharFromKeyCode(e.which),
                    cardSpacePattern;

                foundCardType = getCardType(e.target.value);

                // if not delete
                if (e.which != 8) {

                    if (foundCardType) {
                        cardSpacePattern = (foundCardType.spacePattern) ? foundCardType.spacePattern : _defaultCardSpacePattern;
                        cardIconTypePh.setAttribute('class', 'pf ' + foundCardType.css);
                    } else {
                        cardSpacePattern = _defaultCardSpacePattern;
                        cardIconTypePh.removeAttribute('class');
                    }

                    if (_digitPattern.test(keyVal)) {
                        if (cardSpacePattern.test(e.target.value)) {
                            e.preventDefault();
                            if (e.target.value.length <= 14) {
                                e.target.value += ' ';
                            }
                        }

                        setTimeout(function() {
                            cardNumberPh.innerHTML = e.target.value;
                        }, 0);
                    }
                }
            }

            function getCharFromKeyCode(keyCode) {
                if (keyCode > 96 && keyCode <= 105) {
                    return String.fromCharCode(keyCode - 48);
                } else {
                    return String.fromCharCode(keyCode);
                }
            }

            function filterNumberInput(e) {
                var kCode = e.keyCode || e.which;
                console.log(kCode);
                // Allow: delete, backspace, tab, escape, enter
                if ([46, 8, 9, 27, 13].indexOf(kCode) !== -1 ||
                    // Allow: Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X
                    ([65, 67, 86, 88].indexOf(kCode) !== -1 && e.ctrlKey === true) ||
                    // Allow: home, end, left, right
                    (kCode >= 35 && kCode <= 39) ||
                    // Allow: space bar, shift
                    (e.shiftKey || kCode === 32)) {
                    // let it happen, don't do anything
                    return;
                }

                var kChar = String.fromCharCode(e.charCode);
                if (kChar && /\d/.test(kChar)) {
                    // Ensure that it is a number and stop the keypress
                    return;
                } else {
                    e.preventDefault();
                }
            }

            function reformatDate(e) {
                var value = e.target.value,
                    kCode = e.keyCode || e.which,
                    parts = value.match(/^(\d+)\/?(\d*)/),
                    month,
                    year;

                // if no input or backspace or delete then ignore    
                if (!parts || [8, 46].indexOf(kCode) !== -1) {
                    //do nothing
                    return;
                }

                month = parts[1] || '';
                year = parts[2] || '';

                if (month.length < 2 && month > 1) {
                    month = '0' + month;
                    e.target.value = month;
                    e.target.selectionStart += 1;
                } else if (month.length > 2) {
                    year = month.substring(2) + year;
                    month = month.substring(0, 2);

                    e.target.value = month + '/' + year;
                    // move the cursor over 1 since we've added the '/' char
                    e.target.selectionStart += 1;
                } else if (year.length > 0) {
                    e.target.value = month + '/' + year;
                } else if (month.length < 2) {
                    e.target.value = month;
                } else {
                    e.target.value = month + '/';
                }
            };


            function validateCardNumber(e) {
                var cardNum = e.target.value.replace(/(\s)/g, '');
                if (cardNum !== '') {
                    if (!foundCardType || cardNum.length != foundCardType.numLength) {
                        cardNumberPh.classList.add('invalid');
                        return;
                    }
                } else {
                    cardNumberPh.innerHTML = '';
                }


                cardNumberPh.removeAttribute('class');
            }

            function validateExpiry(e) {
                if (e.target.value !== '') {

                    var parts = e.target.value.match(/^(\d+)\/?(\d*)/),
                        todaysDate = new Date();

                    // check for valid month
                    if (!parts[1] || (parseInt(parts[1]) < 1 || parseInt(parts[1]) > 12)) {
                        expiryPh.classList.add('invalid');
                        return;
                    }

                    // check for valid year
                    if (!parts[2] || ('20' + parseInt(parts[2]) < todaysDate.getFullYear())) {
                        expiryPh.classList.add('invalid');
                        return;
                    }

                    // check for expiration
                    if (parts[1] && parts[2]) {
                        var cardDate = new Date('20' + parts[2], parts[1] - 1, '01');
                        if (cardDate < todaysDate) {
                            expiryPh.classList.add('invalid');
                            return;
                        }
                    }

                    expiryPh.removeAttribute('class');
                }
            }


        });
    </script>
</body>

</html>